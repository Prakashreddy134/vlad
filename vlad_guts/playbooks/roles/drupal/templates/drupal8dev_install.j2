# {{ ansible_managed }}

# Remove everything that might be in the docroot directory.
rm -rf /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/.* /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/*

# Clone Drupal 8 dev branch into the docroot direcory.
git clone --branch 8.0.x http://git.drupal.org/project/drupal.git /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot

# Create a settings.php fie.
cp /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/sites/default/default.settings.php /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/sites/default/settings.php

# Create some directories.
mkdir /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/modules/contrib
mkdir /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot/modules/custom

# Set some lenient permissions on the docroot directory.
chmod -R 777 /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot

# Install Drupal using the Drush.
cd /var/www/vhosts/{{ vlad_webserver_settings.0.directory }}/docroot
drush site-install --db-url=mysql://{{ dbuser }}:{{ dbpass }}@localhost/{{ dbname[0] }} --account-name=admin --account-pass=password --yes
